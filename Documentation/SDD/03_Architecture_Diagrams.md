# Architecture Diagrams

## 3.1 Context Diagram

```
                                    ┌─────────────────────────────────────┐
                                    │                                     │
                                    │     Face Recognition Attendance     │
                                    │              System                 │
                                    │                                     │
                                    └──────────────┬──────────────────────┘
                                                   │
           ┌───────────────────────────────────────┼───────────────────────────────────────┐
           │                                       │                                       │
           ▼                                       ▼                                       ▼
    ┌─────────────┐                        ┌─────────────┐                        ┌─────────────┐
    │             │                        │             │                        │             │
    │   Student   │                        │   Mentor    │                        │    Admin    │
    │             │                        │             │                        │             │
    └─────────────┘                        └─────────────┘                        └─────────────┘
    
    - View attendance                      - Start/end sessions                  - Manage users
    - Enroll face                          - Mark attendance                     - Manage courses
    - View schedule                        - View reports                        - Monitor system
    - Receive notifications                - View schedule                       - Configure settings


                                    ┌─────────────────────────────────────┐
                                    │                                     │
                                    │           Edge Agent                │
                                    │         (Camera System)             │
                                    │                                     │
                                    └─────────────────────────────────────┘
                                    
                                    - Capture video frames
                                    - Detect faces
                                    - Send to recognition API
```

## 3.2 Sequence Diagrams

### 3.2.1 User Login Sequence

```
┌──────┐          ┌──────────┐          ┌───────────┐          ┌──────────┐
│Client│          │API Gateway│          │Auth Service│          │ Database │
└──┬───┘          └────┬─────┘          └─────┬─────┘          └────┬─────┘
   │                   │                      │                     │
   │ POST /api/auth/login                     │                     │
   │ {email, password} │                      │                     │
   │──────────────────>│                      │                     │
   │                   │                      │                     │
   │                   │ authenticate(creds)  │                     │
   │                   │─────────────────────>│                     │
   │                   │                      │                     │
   │                   │                      │ get_user_by_email() │
   │                   │                      │────────────────────>│
   │                   │                      │                     │
   │                   │                      │      User           │
   │                   │                      │<────────────────────│
   │                   │                      │                     │
   │                   │                      │ verify_password()   │
   │                   │                      │─────────┐           │
   │                   │                      │         │           │
   │                   │                      │<────────┘           │
   │                   │                      │                     │
   │                   │                      │ generate_tokens()   │
   │                   │                      │─────────┐           │
   │                   │                      │         │           │
   │                   │                      │<────────┘           │
   │                   │                      │                     │
   │                   │   {access_token,     │                     │
   │                   │    refresh_token}    │                     │
   │                   │<─────────────────────│                     │
   │                   │                      │                     │
   │ Set-Cookie: access_token, refresh_token │                     │
   │ {user, tokens}    │                      │                     │
   │<──────────────────│                      │                     │
   │                   │                      │                     │
```

### 3.2.2 Face Recognition Attendance Sequence

```
┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐
│Edge Agent │     │API Gateway│     │AI Service │     │Attendance │     │Notification│
└─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘     └─────┬─────┘
      │                 │                 │                 │                 │
      │ Capture Frame   │                 │                 │                 │
      │─────────┐       │                 │                 │                 │
      │         │       │                 │                 │                 │
      │<────────┘       │                 │                 │                 │
      │                 │                 │                 │                 │
      │ Detect Face     │                 │                 │                 │
      │─────────┐       │                 │                 │                 │
      │         │       │                 │                 │                 │
      │<────────┘       │                 │                 │                 │
      │                 │                 │                 │                 │
      │ POST /api/ai/recognize/attendance/{session_id}     │                 │
      │ {image_data}    │                 │                 │                 │
      │────────────────>│                 │                 │                 │
      │                 │                 │                 │                 │
      │                 │ recognize(image)│                 │                 │
      │                 │────────────────>│                 │                 │
      │                 │                 │                 │                 │
      │                 │                 │ Extract embedding                 │
      │                 │                 │─────────┐       │                 │
      │                 │                 │         │       │                 │
      │                 │                 │<────────┘       │                 │
      │                 │                 │                 │                 │
      │                 │                 │ Compare with enrolled faces       │
      │                 │                 │─────────┐       │                 │
      │                 │                 │         │       │                 │
      │                 │                 │<────────┘       │                 │
      │                 │                 │                 │                 │
      │                 │ {user_id, confidence}             │                 │
      │                 │<────────────────│                 │                 │
      │                 │                 │                 │                 │
      │                 │ mark_attendance(session_id, user_id, "present")    │
      │                 │────────────────────────────────────>               │
      │                 │                 │                 │                 │
      │                 │                 │                 │ Update record   │
      │                 │                 │                 │─────────┐       │
      │                 │                 │                 │         │       │
      │                 │                 │                 │<────────┘       │
      │                 │                 │                 │                 │
      │                 │                 │                 │ notify(user_id) │
      │                 │                 │                 │────────────────>│
      │                 │                 │                 │                 │
      │                 │                 │                 │ WebSocket push  │
      │                 │                 │                 │<────────────────│
      │                 │                 │                 │                 │
      │ {success: true, user_id, confidence}               │                 │
      │<────────────────│                 │                 │                 │
      │                 │                 │                 │                 │
```

### 3.2.3 Start Attendance Session Sequence

```
┌──────┐          ┌───────────┐          ┌───────────┐          ┌───────────┐
│Mentor│          │API Gateway│          │Attendance │          │Notification│
└──┬───┘          └─────┬─────┘          └─────┬─────┘          └─────┬─────┘
   │                    │                      │                      │
   │ POST /api/attendance/sessions/start       │                      │
   │ {class_id}         │                      │                      │
   │───────────────────>│                      │                      │
   │                    │                      │                      │
   │                    │ start_session(class_id)                     │
   │                    │─────────────────────>│                      │
   │                    │                      │                      │
   │                    │                      │ Create session       │
   │                    │                      │ (state: active)      │
   │                    │                      │─────────┐            │
   │                    │                      │         │            │
   │                    │                      │<────────┘            │
   │                    │                      │                      │
   │                    │                      │ Initialize records   │
   │                    │                      │ (all students absent)│
   │                    │                      │─────────┐            │
   │                    │                      │         │            │
   │                    │                      │<────────┘            │
   │                    │                      │                      │
   │                    │                      │ notify_students()    │
   │                    │                      │─────────────────────>│
   │                    │                      │                      │
   │                    │                      │                      │ WebSocket
   │                    │                      │                      │ broadcast
   │                    │                      │                      │─────────┐
   │                    │                      │                      │         │
   │                    │                      │                      │<────────┘
   │                    │                      │                      │
   │                    │ {session_id, state}  │                      │
   │                    │<─────────────────────│                      │
   │                    │                      │                      │
   │ {session}          │                      │                      │
   │<───────────────────│                      │                      │
   │                    │                      │                      │
```

### 3.2.4 Face Enrollment Sequence

```
┌──────┐          ┌───────────┐          ┌───────────┐          ┌──────────┐
│Student│         │API Gateway│          │AI Service │          │ Database │
└──┬───┘          └─────┬─────┘          └─────┬─────┘          └────┬─────┘
   │                    │                      │                     │
   │ POST /api/ai/enroll│                      │                     │
   │ {user_id, image}   │                      │                     │
   │───────────────────>│                      │                     │
   │                    │                      │                     │
   │                    │ enroll_face(user_id, image)                │
   │                    │─────────────────────>│                     │
   │                    │                      │                     │
   │                    │                      │ Detect face         │
   │                    │                      │─────────┐           │
   │                    │                      │         │           │
   │                    │                      │<────────┘           │
   │                    │                      │                     │
   │                    │                      │ Analyze quality     │
   │                    │                      │─────────┐           │
   │                    │                      │         │           │
   │                    │                      │<────────┘           │
   │                    │                      │                     │
   │                    │                      │ Classify pose       │
   │                    │                      │─────────┐           │
   │                    │                      │         │           │
   │                    │                      │<────────┘           │
   │                    │                      │                     │
   │                    │                      │ Check duplicates    │
   │                    │                      │─────────┐           │
   │                    │                      │         │           │
   │                    │                      │<────────┘           │
   │                    │                      │                     │
   │                    │                      │ Extract embedding   │
   │                    │                      │─────────┐           │
   │                    │                      │         │           │
   │                    │                      │<────────┘           │
   │                    │                      │                     │
   │                    │                      │ Store encoding      │
   │                    │                      │────────────────────>│
   │                    │                      │                     │
   │                    │                      │      OK             │
   │                    │                      │<────────────────────│
   │                    │                      │                     │
   │                    │                      │ Update centroid     │
   │                    │                      │────────────────────>│
   │                    │                      │                     │
   │                    │                      │      OK             │
   │                    │                      │<────────────────────│
   │                    │                      │                     │
   │                    │ {success, quality_score, pose}             │
   │                    │<─────────────────────│                     │
   │                    │                      │                     │
   │ {enrollment_result}│                      │                     │
   │<───────────────────│                      │                     │
   │                    │                      │                     │
```

## 3.3 Class Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    DOMAIN MODELS                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐            │
│  │      User       │       │     Course      │       │      Class      │            │
│  ├─────────────────┤       ├─────────────────┤       ├─────────────────┤            │
│  │ - id: UUID      │       │ - id: UUID      │       │ - id: UUID      │            │
│  │ - email: str    │       │ - code: str     │       │ - name: str     │            │
│  │ - password_hash │       │ - name: str     │       │ - course_id: FK │            │
│  │ - full_name: str│       │ - description   │       │ - mentor_id: FK │            │
│  │ - role: enum    │       │ - created_at    │       │ - day_of_week   │            │
│  │ - student_id    │       └────────┬────────┘       │ - schedule_time │            │
│  │ - is_active     │                │                │ - room_number   │            │
│  │ - created_at    │                │ 1              └────────┬────────┘            │
│  └────────┬────────┘                │                         │                     │
│           │                         │                         │ *                   │
│           │ 1                       │ *                       │                     │
│           │                  ┌──────┴──────┐           ┌──────┴──────┐              │
│           │                  │             │           │             │              │
│           │                  ▼             │           ▼             │              │
│           │         ┌─────────────────┐    │  ┌─────────────────┐    │              │
│           │         │   Enrollment    │    │  │AttendanceSession│    │              │
│           │         ├─────────────────┤    │  ├─────────────────┤    │              │
│           │         │ - student_id: FK│◄───┘  │ - id: UUID      │    │              │
│           │         │ - class_id: FK  │       │ - class_id: FK  │◄───┘              │
│           │         │ - enrolled_at   │       │ - start_time    │                   │
│           │         └─────────────────┘       │ - end_time      │                   │
│           │                                   │ - state: enum   │                   │
│           │                                   └────────┬────────┘                   │
│           │                                            │                            │
│           │ *                                          │ 1                          │
│           │                                            │                            │
│    ┌──────┴──────┐                              ┌──────┴──────┐                     │
│    │             │                              │             │                     │
│    ▼             │                              ▼             │                     │
│  ┌─────────────────┐                    ┌─────────────────┐   │                     │
│  │  FaceEncoding   │                    │AttendanceRecord │   │                     │
│  ├─────────────────┤                    ├─────────────────┤   │                     │
│  │ - id: UUID      │                    │ - id: UUID      │   │                     │
│  │ - user_id: FK   │                    │ - session_id: FK│◄──┘                     │
│  │ - encoding: []  │                    │ - student_id: FK│                         │
│  │ - quality_score │                    │ - status: enum  │                         │
│  │ - pose_category │                    │ - timestamp     │                         │
│  │ - created_at    │                    │ - confidence    │                         │
│  └─────────────────┘                    │ - method: str   │                         │
│                                         └─────────────────┘                         │
│                                                                                      │
│  ┌─────────────────┐       ┌─────────────────┐                                      │
│  │  Notification   │       │   UserCentroid  │                                      │
│  ├─────────────────┤       ├─────────────────┤                                      │
│  │ - id: UUID      │       │ - user_id: FK   │                                      │
│  │ - user_id: FK   │       │ - centroid: []  │                                      │
│  │ - type: enum    │       │ - embed_count   │                                      │
│  │ - title: str    │       │ - avg_quality   │                                      │
│  │ - message: str  │       │ - pose_coverage │                                      │
│  │ - is_read: bool │       └─────────────────┘                                      │
│  │ - created_at    │                                                                │
│  └─────────────────┘                                                                │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## 3.4 Deployment Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DEPLOYMENT ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                              CLIENT DEVICES                                  │    │
│  │                                                                              │    │
│  │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                   │    │
│  │  │   Desktop    │    │   Laptop     │    │   Mobile     │                   │    │
│  │  │   Browser    │    │   Browser    │    │   Browser    │                   │    │
│  │  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                   │    │
│  │         │                   │                   │                            │    │
│  └─────────┼───────────────────┼───────────────────┼────────────────────────────┘    │
│            │                   │                   │                                  │
│            └───────────────────┼───────────────────┘                                  │
│                                │                                                      │
│                                │ HTTPS (Port 443)                                    │
│                                │                                                      │
│  ┌─────────────────────────────┼────────────────────────────────────────────────┐    │
│  │                             ▼                                                │    │
│  │  ┌──────────────────────────────────────────────────────────────────────┐   │    │
│  │  │                         NGINX (Reverse Proxy)                         │   │    │
│  │  │                         - SSL Termination                             │   │    │
│  │  │                         - Load Balancing                              │   │    │
│  │  │                         - Static File Serving                         │   │    │
│  │  └──────────────────────────────┬───────────────────────────────────────┘   │    │
│  │                                 │                                            │    │
│  │            ┌────────────────────┼────────────────────┐                      │    │
│  │            │                    │                    │                      │    │
│  │            ▼                    ▼                    ▼                      │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │    │
│  │  │  FastAPI App    │  │  FastAPI App    │  │  React Static   │             │    │
│  │  │  (Instance 1)   │  │  (Instance 2)   │  │  Files          │             │    │
│  │  │  Port: 8000     │  │  Port: 8001     │  │                 │             │    │
│  │  └────────┬────────┘  └────────┬────────┘  └─────────────────┘             │    │
│  │           │                    │                                            │    │
│  │           └────────────────────┘                                            │    │
│  │                    │                                                        │    │
│  │                    ▼                                                        │    │
│  │  ┌──────────────────────────────────────────────────────────────────────┐  │    │
│  │  │                         DATA LAYER                                    │  │    │
│  │  │                                                                       │  │    │
│  │  │  ┌─────────────────────┐       ┌─────────────────────┐               │  │    │
│  │  │  │     PostgreSQL      │       │       Redis         │               │  │    │
│  │  │  │     Port: 5432      │       │     Port: 6379      │               │  │    │
│  │  │  │                     │       │                     │               │  │    │
│  │  │  │  - Users            │       │  - Session Cache    │               │  │    │
│  │  │  │  - Courses          │       │  - Rate Limiting    │               │  │    │
│  │  │  │  - Classes          │       │  - Token Blacklist  │               │  │    │
│  │  │  │  - Attendance       │       │                     │               │  │    │
│  │  │  │  - Face Encodings   │       │                     │               │  │    │
│  │  │  └─────────────────────┘       └─────────────────────┘               │  │    │
│  │  │                                                                       │  │    │
│  │  └──────────────────────────────────────────────────────────────────────┘  │    │
│  │                                                                             │    │
│  │                              SERVER INFRASTRUCTURE                          │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                              CLASSROOM                                       │    │
│  │                                                                              │    │
│  │  ┌──────────────────────────────────────────────────────────────────────┐   │    │
│  │  │                         Edge Agent Device                             │   │    │
│  │  │                                                                       │   │    │
│  │  │  ┌─────────────────┐       ┌─────────────────┐                       │   │    │
│  │  │  │     Camera      │──────>│   Edge Agent    │                       │   │    │
│  │  │  │   (USB/IP)      │       │   (Python)      │                       │   │    │
│  │  │  └─────────────────┘       └────────┬────────┘                       │   │    │
│  │  │                                     │                                 │   │    │
│  │  └─────────────────────────────────────┼─────────────────────────────────┘   │    │
│  │                                        │                                      │    │
│  │                                        │ HTTP (API Calls)                    │    │
│  │                                        │                                      │    │
│  └────────────────────────────────────────┼──────────────────────────────────────┘    │
│                                           │                                           │
│                                           └───────────────────────────────────────────┘
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```
